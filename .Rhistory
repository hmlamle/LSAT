"Fortlauderdale",   "FTL",      "20250721",   25,
"Southcanyon",      "SC",       "20231020",   25,
"Emerald",          "ER",       "20250622",   12,
"NNDR",             "NNDR",     "20251010",   25
)
scales <- c(25, 50, 100)   # measurement boxes
get_rugosity_folder <- function(site_name, site_code, date, scale_cm) {
file.path(
base_dir,
"2. Viscore rugosity metrics",
site_name,
paste0(site_code, "_", date),
paste0(scale_cm, "cm box")
)
}
## --- Slope rasters (ArcGIS) -------------
get_slope_file <- function(site_name, site_code, date, scale_cm) {
file.path(
base_dir,
"3. GIS rugosity metrics",
site_name,
paste0(site_code, "_", date),
paste0("slope_", scale_cm, "cm.csv")
)
}
## --- Biological LSAT data (turf + sediment) --------
get_bio_file <- function(site_name, site_code, date) {
file.path(
base_dir,
"4. Biological metrics",
site_name,
paste0(site_code, "_", date),
paste0(site_code, "_", date, "_lsat.xlsx")
)
}
read_rugosity <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
purrr::map_dfr(scales, function(s) {
folder <- get_rugosity_folder(site_name, site_code, survey_date, s)
files <- list.files(folder, pattern = "\\.csv$", full.names = TRUE)
if (length(files) == 0) {
warning("No rugosity files found for ", site_name, " scale ", s)
return(NULL)
}
# Read all CSVs, assign manual column names (no header in Viscore files)
data_list <- purrr::map(files, ~read_csv(.x,
col_names = c("spacing", "transect", "sample", "x", "y", "z"),
show_col_types = FALSE))
# Calculate rugosity per file (each file = one nail)
rugo <- purrr::map2_dfr(data_list, seq_along(data_list), ~{
df <- .x
nail_id <- as.character(.y)
df %>%
filter(z != 0) %>%
group_by(transect) %>%
summarise(
standard_length = sum(sqrt(diff(x)^2 + diff(y)^2)),
true_length = sum(sqrt(diff(x)^2 + diff(y)^2 + diff(z)^2)),
rugosity = true_length / standard_length,
point_range = max(z) - min(z),
.groups = "drop"
) %>%
summarise(
rugo_mean = mean(rugosity),
rugo_var  = var(rugosity),
avg_point_range = mean(point_range)
) %>%
mutate(
nail = nail_id,
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
)
})
return(rugo)
})
})
}
read_slope <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
purrr::map_dfr(scales, function(s) {
file <- get_slope_file(site_name, site_code, survey_date, s)
if (!file.exists(file)) {
warning("Missing slope file: ", file)
return(NULL)
}
read_csv(file, col_types = cols(), show_col_types = FALSE) %>%
rename(
nail = OBJECTID_1,
slope_mean = MEAN
) %>%
mutate(
nail = as.character(nail),
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
) %>%
select(nail, slope_mean, site, site_code, date, scale_cm)
})
})
}
read_bio <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
file <- get_bio_file(site_name, site_code, survey_date)
if (!file.exists(file)) {
warning("Missing biological LSAT file: ", file)
return(NULL)
}
readxl::read_excel(file) %>%
mutate(
site = site_name,
site_code = site_code,
date = survey_date
)
})
}
rugosity_raw <- read_rugosity()
View(rugosity_raw)
slope_raw    <- read_slope()
View(slope_raw)
View(rugosity_raw)
library(tidyverse)
library(ggplot2)
get_centroids_from_folder <- function(folder_path, scale_cm, site_name) {
files <- list.files(folder_path, pattern = "\\.csv$", full.names = TRUE)
map_dfr(files, function(file) {
nail_id <- tools::file_path_sans_ext(basename(file))  # gets 'p22.1' etc
df <- read_csv(file, col_names = c("spacing", "transect", "sample", "x", "y", "z"),
show_col_types = FALSE)
df %>%
summarise(
mean_x = mean(x, na.rm=TRUE),
mean_y = mean(y, na.rm=TRUE)
) %>%
mutate(
nail = nail_id,
scale_cm = scale_cm,
site = site_name
)
})
}
folder_50cm <- "C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/raw/LSAT/2. Viscore rugosity metrics/Fortlauderdale/FTL_20250721/50cm box"
centroids_50 <- get_centroids_from_folder(folder_50cm, 50, "FortLauderdale")
folder_25cm <- "C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/raw/LSAT/2. Viscore rugosity metrics/Fortlauderdale/FTL_20250721/25cm box"
folder_100cm <- "C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/raw/LSAT/2. Viscore rugosity metrics/Fortlauderdale/FTL_20250721/100cm box"
centroids_25 <- get_centroids_from_folder(folder_25cm, 25, "FortLauderdale")
centroids_100 <- get_centroids_from_folder(folder_100cm, 100, "FortLauderdale")
ggplot(centroids_all, aes(x = mean_x, y = mean_y, color = as.factor(scale_cm), shape = as.factor(scale_cm))) +
geom_point(size = 3, alpha = 0.8) +
geom_text(aes(label = nail), vjust = -1, size = 3) +
labs(title = "Centroid positions of LSAT boxes by scale (Fort Lauderdale)",
x = "X coordinate",
y = "Y coordinate",
color = "Scale (cm)",
shape = "Scale (cm)") +
theme_minimal() +
theme(legend.position = "bottom") +
coord_fixed(ratio = 0.4)
centroids_all <- bind_rows(centroids_25, centroids_50, centroids_100)
ggplot(centroids_all, aes(x = mean_x, y = mean_y, color = as.factor(scale_cm), shape = as.factor(scale_cm))) +
geom_point(size = 3, alpha = 0.8) +
geom_text(aes(label = nail), vjust = -1, size = 3) +
labs(title = "Centroid positions of LSAT boxes by scale (Fort Lauderdale)",
x = "X coordinate",
y = "Y coordinate",
color = "Scale (cm)",
shape = "Scale (cm)") +
theme_minimal() +
theme(legend.position = "bottom") +
coord_fixed(ratio = 0.4)
library(tidyverse)
library(readxl)
base_dir <- "C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/raw/LSAT"
sites <- tibble::tribble(
~site_name,         ~site_code, ~survey_date, ~n_points,
"Fortlauderdale",   "FTL",      "20250721",   25,
"Southcanyon",      "SC",       "20231020",   25,
"Emerald",          "ER",       "20250622",   12,
"NNDR",             "NNDR",     "20251010",   25
)
scales <- c(25, 50, 100)   # measurement boxes
get_rugosity_folder <- function(site_name, site_code, date, scale_cm) {
file.path(
base_dir,
"2. Viscore rugosity metrics",
site_name,
paste0(site_code, "_", date),
paste0(scale_cm, "cm box")
)
}
## --- Slope rasters (ArcGIS) -------------
get_slope_file <- function(site_name, site_code, date, scale_cm) {
file.path(
base_dir,
"3. GIS rugosity metrics",
site_name,
paste0(site_code, "_", date),
paste0("slope_", scale_cm, "cm.csv")
)
}
## --- Biological LSAT data (turf + sediment) --------
get_bio_file <- function(site_name, site_code, date) {
file.path(
base_dir,
"4. Biological metrics",
site_name,
paste0(site_code, "_", date),
paste0(site_code, "_", date, "_lsat.xlsx")
)
}
read_rugosity <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
purrr::map_dfr(scales, function(s) {
folder <- get_rugosity_folder(site_name, site_code, survey_date, s)
files <- list.files(folder, pattern = "\\.csv$", full.names = TRUE)
if (length(files) == 0) {
warning("No rugosity files found for ", site_name, " scale ", s)
return(NULL)
}
# Read all CSVs, assign manual column names (no header in Viscore files)
data_list <- purrr::map(files, ~read_csv(.x,
col_names = c("spacing", "transect", "sample", "x", "y", "z"),
show_col_types = FALSE))
# Calculate rugosity per file (each file = one nail)
rugo <- purrr::map2_dfr(data_list, seq_along(data_list), ~{
df <- .x
nail_id <- as.character(.y)
df %>%
filter(z != 0) %>%
group_by(transect) %>%
summarise(
standard_length = sum(sqrt(diff(x)^2 + diff(y)^2)),
true_length = sum(sqrt(diff(x)^2 + diff(y)^2 + diff(z)^2)),
rugosity = true_length / standard_length,
point_range = max(z) - min(z),
.groups = "drop"
) %>%
summarise(
rugo_mean = mean(rugosity),
rugo_var  = var(rugosity),
avg_point_range = mean(point_range)
) %>%
mutate(
nail = nail_id,
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
)
})
return(rugo)
})
})
}
read_slope <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
purrr::map_dfr(scales, function(s) {
file <- get_slope_file(site_name, site_code, survey_date, s)
if (!file.exists(file)) {
warning("Missing slope file: ", file)
return(NULL)
}
read_csv(file, col_types = cols(), show_col_types = FALSE) %>%
rename(
nail = OBJECTID_1,
slope_mean = MEAN
) %>%
mutate(
nail = as.character(nail),
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
) %>%
select(nail, slope_mean, site, site_code, date, scale_cm)
})
})
}
read_bio <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
file <- get_bio_file(site_name, site_code, survey_date)
if (!file.exists(file)) {
warning("Missing biological LSAT file: ", file)
return(NULL)
}
readxl::read_excel(file) %>%
mutate(
site = site_name,
site_code = site_code,
date = survey_date
)
})
}
rugosity_raw <- read_rugosity()
View(rugosity_raw)
rugosity_raw <- read_rugosity()
View(rugosity_raw)
View(rugosity_raw)
slope_raw    <- read_slope()
View(slope_raw)
read_slope <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
purrr::map_dfr(scales, function(s) {
file <- get_slope_file(site_name, site_code, survey_date, s)
if (!file.exists(file)) {
warning("Missing slope file: ", file)
return(NULL)
}
read_csv(file, col_types = cols(), show_col_types = FALSE) %>%
rename(
nail = OBJECTID_1,
slope_mean = MEAN,
slope_var = STD
) %>%
mutate(
nail = as.character(nail),
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
) %>%
select(nail, slope_mean, site, site_code, date, scale_cm)
})
})
}
read_bio <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
file <- get_bio_file(site_name, site_code, survey_date)
if (!file.exists(file)) {
warning("Missing biological LSAT file: ", file)
return(NULL)
}
readxl::read_excel(file) %>%
mutate(
site = site_name,
site_code = site_code,
date = survey_date
)
})
}
rugosity_raw <- read_rugosity()
slope_raw    <- read_slope()
View(slope_raw)
read_csv(file, col_types = cols(), show_col_types = FALSE) %>%
rename(
nail = OBJECTID_1,
slope_mean = MEAN,
slope_var = STD
) %>%
mutate(
nail = as.character(nail),
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
) %>%
select(nail, slope_mean, slope_var, site, site_code, date, scale_cm)
read_slope <- function() {
purrr::pmap_dfr(sites, function(site_name, site_code, survey_date, n_points) {
purrr::map_dfr(scales, function(s) {
file <- get_slope_file(site_name, site_code, survey_date, s)
if (!file.exists(file)) {
warning("Missing slope file: ", file)
return(NULL)
}
read_csv(file, col_types = cols(), show_col_types = FALSE) %>%
rename(
nail = OBJECTID_1,
slope_mean = MEAN,
slope_var = STD
) %>%
mutate(
nail = as.character(nail),
scale_cm = s,
site = site_name,
site_code = site_code,
date = survey_date
) %>%
select(nail, slope_mean, slope_var, site, site_code, date, scale_cm)
})
})
}
slope_raw    <- read_slope()
View(slope_raw)
bio_raw      <- read_bio()
View(bio_raw)
bio_raw      <- read_bio()
View(bio_raw)
bio_raw      <- read_bio()
View(bio_raw)
names(bio_raw)
bio_raw      <- read_bio()
View(bio_raw)
bio_clean <- bio_raw %>%
rename(
turf_length = turf_length_mm,
sediment_depth = sed_depth_mm,
nail = Plot
)
bio_clean$nail <- as.character(bio_clean$nail)
# Join rugosity & slope by site, date, scale, nail
rs_joined <- full_join(rugosity_raw, slope_raw,
by = c("site", "site_code", "date", "scale_cm", "nail"))
View(rs_joined)
# Join biological data by site, date, nail (no scale for biology)
master_lsat <- left_join(rs_joined, bio_clean,
by = c("site", "site_code", "date", "nail"))
View(master_lsat)
write_csv(master_lsat, "C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/toUse/LSAT/master_LSAT_dataset.csv")
View(bio_raw)
rugosity_raw <- read_rugosity()
slope_raw    <- read_slope()
bio_raw      <- read_bio()
bio_clean <- bio_raw %>%
rename(
turf_length = turf_length_mm,
sediment_depth = sed_depth_mm,
nail = Plot
)
bio_clean$nail <- as.character(bio_clean$nail)
# Join rugosity & slope by site, date, scale, nail
rs_joined <- full_join(rugosity_raw, slope_raw,
by = c("site", "site_code", "date", "scale_cm", "nail"))
# Join biological data by site, date, nail (no scale for biology)
master_lsat <- left_join(rs_joined, bio_clean,
by = c("site", "site_code", "date", "nail"))
View(master_lsat)
View(master_lsat)
library(tidyverse)
library(janitor)
library(ggpubr)
library(tidyverse)
install.packages("janitor")
library(tidyverse)
library(janitor)
library(ggpubr)
library(GGally)
install.packages("ggally")
library(GGally)
install.packages("GGally")
library(GGally)
update.packages("ggplot2")
library(GGally)
library(sf)
master <- read_csv("C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/toUse/LSAT/master_LSAT_dataset.csv") %>%
clean_names()
# Quick structure ---------------------------------------------------------------
glimpse(master)
summary(master)
num_vars <- master %>% select(where(is.numeric))
# Histograms
num_vars %>%
gather(variable, value) %>%
ggplot(aes(value)) +
geom_histogram(bins = 30) +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Density plots
num_vars %>%
gather(variable, value) %>%
ggplot(aes(value)) +
geom_density() +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Correlation matrix (numeric only)
ggcor <- ggcorr(num_vars, label = TRUE, label_round = 2)
library(GGally)
update.packages(ggplot2)
update.packages("ggplot2")
# -----------------------------------------------------------------------------
# 5. LSAT vs predictors ---------------------------------------------------------
# -----------------------------------------------------------------------------
# Scatterplots with smoothing lines
predictors <- c("rugosity_25", "rugosity_50", "rugosity_100",
"slope_mean", "slope_var", "depth", "distance_to_structure")
for (p in predictors) {
fig <- master %>%
ggplot(aes(x = .data[[p]], y = lsat_cover, color = site)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "loess", se = TRUE) +
theme_bw() +
ggtitle(paste("LSAT vs", p))
print(fig)
}
# -----------------------------------------------------------------------------
# 4. Site differences -----------------------------------------------------------
# -----------------------------------------------------------------------------
# Boxplots comparing sites for major variables
vars_of_interest <- c("lsat_cover", "rugosity_25", "rugosity_50", "rugosity_100",
"slope_mean", "slope_var")
p <- master %>%
ggplot(aes(x = site, y = .data[[v]], fill = site)) +
geom_boxplot() +
theme_bw() +
ggtitle(paste("Site comparison:", v))
print(p)
# -----------------------------------------------------------------------------
# 4. Site differences -----------------------------------------------------------
# -----------------------------------------------------------------------------
# Boxplots comparing sites for major variables
vars_of_interest <- c("lsat_cover", "rugosity_25", "rugosity_50", "rugosity_100",
"slope_mean", "slope_var")
for (v in vars_of_interest) {
p <- master %>%
ggplot(aes(x = site, y = .data[[v]], fill = site)) +
geom_boxplot() +
theme_bw() +
ggtitle(paste("Site comparison:", v))
print(p)
}
