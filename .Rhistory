mutate(
formula = paste(response, "~", predictor),
data_subset = map(scale, ~ filter(master, scale_cm == .x)),
model = map2(formula, data_subset, ~ lm(as.formula(.x), data = .y)),
summary = map(model, summary),
r_squared = map_dbl(summary, ~ .x$r.squared),
p_value = map_dbl(summary, ~ coef(.x)[2,4])
)
print(model_results %>% select(response, predictor, scale, r_squared, p_value))
plots <- model_results %>%
mutate(
plot_obj = pmap(list(response, predictor, scale), function(resp, pred, scl) {
ggplot(filter(master, scale_cm == scl), aes_string(x = pred, y = resp)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm", se = TRUE, color = "blue") +
theme_bw() +
labs(
title = paste(resp, "vs", pred, "at", scl, "cm scale"),
x = pred,
y = resp
)
})
)
walk(plots$plot_obj, print)
table(master$scale_cm)
master %>%
group_by(scale_cm) %>%
summarise(
n = n(),
rugo_mean_n = sum(!is.na(rugo_mean)),
slope_mean_n = sum(!is.na(slope_mean)),
sapr_n = sum(!is.na(sapr)),
std_curve_n = sum(!is.na(std_curve)),
plan_curve_n = sum(!is.na(plan_curve)),
tpi_n = sum(!is.na(tpi))
)
print(model_results %>% select(response, predictor, scale, r_squared, p_value))
interaction_models <- list()
interaction_turf <- list()
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
mod <- lm(turf_length ~ rugo_mean * slope_mean, data = master)
interaction_models[[paste0("scale_", s)]] <- summary(mod)
cat("\n--- Scale:", s, "cm ---\n")
print(summary(mod))
}
print(interaction_turf)
interaction_turf <- list()
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
mod <- lm(turf_length ~ rugo_mean * slope_mean, data = master)
interaction_models[[paste0("scale_", s)]] <- summary(mod)
cat("\n--- Scale:", s, "cm ---\n")
print(summary(mod))
}
interaction_turf[[paste0("scale_", s)]] <- summary(mod)
View(interaction_turf)
interaction_turf <- list()
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
mod <- lm(turf_length ~ rugo_mean * slope_mean, data = master)
interaction_turf[[paste0("scale_", s)]] <- summary(mod)
cat("\n--- Scale:", s, "cm ---\n")
print(summary(mod))
}
colnames(master)
distinct(master, scale_cm)
master <- master %>% mutate(scale_cm = as.numeric(scale_cm))
scales <- c(25, 50, 100)
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
cat("\nScale:", s, "cm  n =", nrow(data_sub), "\n")
mod <- lm(turf_length ~ rugo_mean * slope_mean, data = data_sub)
print(summary(mod))
}
master <- master %>% mutate(scale_cm = as.numeric(scale_cm))
scales <- c(25, 50, 100) # this is already in the environment if you've run script 1 but re-confirming
interaction_turf <- list()
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
mod <- lm(turf_length ~ rugo_mean * slope_mean, data = master)
interaction_turf[[paste0("scale_", s)]] <- summary(mod)
cat("\n--- Scale:", s, "cm ---\n")
print(summary(mod))
}
master <- master %>% mutate(scale_cm = as.numeric(scale_cm))
scales <- c(25, 50, 100) # this is already in the environment if you've run script 1 but re-confirming
interaction_turf <- list()
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
cat("\nScale:", s, "cm  n =", nrow(data_sub), "\n")
mod <- lm(turf_length ~ rugo_mean * slope_mean, data = data_sub)
print(summary(mod))
}
predictors <- c("rugo_mean", "slope_mean", "sapr", "std_curve", "plan_curve", "tpi")
responses <- c("turf_length", "sediment_depth")
# Create all combinations of response, predictor, scale
model_grid <- expand.grid(response = responses, predictor = predictors, scale = scales)
model_results <- model_grid %>%
mutate(
formula = paste(response, "~", predictor),
data_subset = map(scale, ~ filter(master, scale_cm == .x)),
model = map2(formula, data_subset, ~ lm(as.formula(.x), data = .y)),
summary = map(model, summary),
r_squared = map_dbl(summary, ~ .x$r.squared),
p_value = map_dbl(summary, ~ coef(.x)[2,4])
)
print(model_results %>% select(response, predictor, scale, r_squared, p_value))
# store outputs
lm_results <- list()
gam_results <- list()
plots <- list()
# Loop through responses, scales, and predictors --------------------------------
for (resp in responses) {
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
for (pred in predictors) {
# Skip if predictor missing for that scale
if (!pred %in% names(data_sub)) next
# Linear model ------------------------------------------------------------
lm_fit <- lm(as.formula(paste(resp, "~", pred)), data = data_sub)
lm_df <- tidy(lm_fit)
lm_r2 <- glance(lm_fit)$r.squared
lm_results[[paste(resp, s, pred, sep = "_")]] <-
list(scale = s, response = resp, predictor = pred,
summary = lm_df, r2 = lm_r2)
# GAM model ---------------------------------------------------------------
gam_fit <- gam(as.formula(paste(resp, "~ s(", pred, ")")),
data = data_sub, method = "REML")
gam_df <- tidy(gam_fit)
gam_r2 <- summary(gam_fit)$r.sq
gam_results[[paste("GAM", resp, s, pred, sep = "_")]] <-
list(scale = s, response = resp, predictor = pred,
summary = gam_df, r2 = gam_r2)
# Plot smoother -----------------------------------------------------------
p <- ggplot(data_sub, aes_string(x = pred, y = resp, color = "site")) +
geom_point(alpha = 0.5) +
geom_smooth(method = "loess", se = TRUE) +
theme_bw() +
labs(
title = paste(resp, "vs", pred, "| Scale:", s, "cm"),
x = pred,
y = resp
) +
theme(plot.title = element_text(hjust = 0.5))
plots[[paste(resp, s, pred, sep = "_")]] <- p
}
}
}
library(patchwork)
library(purrr)
library(mgcv)
library(broom)
# Loop through responses, scales, and predictors --------------------------------
for (resp in responses) {
for (s in scales) {
data_sub <- master %>% filter(scale_cm == s)
for (pred in predictors) {
# Skip if predictor missing for that scale
if (!pred %in% names(data_sub)) next
# Linear model ------------------------------------------------------------
lm_fit <- lm(as.formula(paste(resp, "~", pred)), data = data_sub)
lm_df <- tidy(lm_fit)
lm_r2 <- glance(lm_fit)$r.squared
lm_results[[paste(resp, s, pred, sep = "_")]] <-
list(scale = s, response = resp, predictor = pred,
summary = lm_df, r2 = lm_r2)
# GAM model ---------------------------------------------------------------
gam_fit <- gam(as.formula(paste(resp, "~ s(", pred, ")")),
data = data_sub, method = "REML")
gam_df <- tidy(gam_fit)
gam_r2 <- summary(gam_fit)$r.sq
gam_results[[paste("GAM", resp, s, pred, sep = "_")]] <-
list(scale = s, response = resp, predictor = pred,
summary = gam_df, r2 = gam_r2)
# Plot smoother -----------------------------------------------------------
p <- ggplot(data_sub, aes_string(x = pred, y = resp, color = "site")) +
geom_point(alpha = 0.5) +
geom_smooth(method = "loess", se = TRUE) +
theme_bw() +
labs(
title = paste(resp, "vs", pred, "| Scale:", s, "cm"),
x = pred,
y = resp
) +
theme(plot.title = element_text(hjust = 0.5))
plots[[paste(resp, s, pred, sep = "_")]] <- p
}
}
}
# To view results:
lm_results
# To view all plots:
for (nm in names(plots)) print(plots[[nm]])
# Example: View a single plot
plots[["turf_length_25_std_curve"]]
all_sites_scale <- lm(turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master)
summary(mod)
summary(all_sites_scale)
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = levels(master$scale_cm)
)
newdata_rugo$pred <- predict(mod, newdata = newdata_rugo)
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
master$scale_cm <- factor(master$scale_cm)
all_sites_scale <- lm(turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master)
summary(all_sites_scale)
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = levels(master$scale_cm)
)
newdata_rugo$pred <- predict(mod, newdata = newdata_rugo)
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
table(master$scale_cm)
master$scale_cm <- factor(master$scale_cm, levels = c("25","50","100"))
all_sites_scale <- lm(turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master)
summary(all_sites_scale)
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = levels(master$scale_cm)
)
newdata_rugo$pred <- predict(mod, newdata = newdata_rugo)
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
head(newdata_rugo)
master$scale_cm <- factor(master$scale_cm, levels = c(25, 50, 100))
master$scale_cm <- factor(master$scale_cm, levels = c(25, 50, 100))
# fit model
all_sites_scale <- lm(
turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master
)
summary(all_sites_scale)
# prediction grid: vary rugosity, hold slope constant, include all 3 scales
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# correct model name here
newdata_rugo$pred <- predict(all_sites_scale, newdata = newdata_rugo)
# plot
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
# prediction grid: vary slope, hold rugosity constant, include all 3 scales
newdata_slope <- expand.grid(
slope_mean = seq(min(master$slope_mean, na.rm = TRUE),
max(master$slope_mean, na.rm = TRUE),
length.out = 100),
rugo_mean = mean(master$rugo_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# predicted values
newdata_slope$pred <- predict(all_sites_scale, newdata = newdata_slope)
# plot
ggplot(master, aes(x = slope_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_slope,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Slope on Turf Across Scales",
x = "Slope",
y = "Turf Length",
color = "Scale (cm)")
library(ggplot2)
master <- read.csv("C:\Users\hanna\Florida International University\Coral Reef Fisheries - 2. Hannah-Marie Lamle\data\toUse\LSAT\master_LSAT_dataset.csv")
library(ggplot2)
library(purrr)
master <- read.csv("C:\Users\hanna\Florida International University\Coral Reef Fisheries - 2. Hannah-Marie Lamle\data\toUse\LSAT\master_LSAT_dataset.csv")
master <- read_csv("C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/toUse/LSAT/master_LSAT_dataset.csv")
library(tidyverse)
library(ggpubr)
library(ggplot2)
library(dplyr)
library(purrr)
master <- read_csv("C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/toUse/LSAT/master_LSAT_dataset.csv")
library(tidyverse)
library(ggpubr)
library(ggplot2)
library(dplyr)
library(purrr)
```{r}
master$scale_cm <- factor(master$scale_cm, levels = c(25, 50, 100))
# fit model
all_sites_scale <- lm(
turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master
)
summary(all_sites_scale)
# prediction grid: vary rugosity, hold slope constant, include all 3 scales
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# correct model name here
newdata_rugo$pred <- predict(all_sites_scale, newdata = newdata_rugo)
# plot
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
# predicted values
newdata_slope$pred <- predict(all_sites_scale, newdata = newdata_slope)
# plot
ggplot(master, aes(x = slope_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_slope,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Slope on Turf Across Scales",
x = "Slope",
y = "Turf Length",
color = "Scale (cm)")
# fit model
all_sites_scale <- lm(
turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master
)
summary(all_sites_scale)
num_vars <- master %>% select(rugo_mean, slope_mean, sapr, std_curve, plan_curve, tpi)
num_vars %>%
gather(variable, value) %>%
ggplot(aes(value)) +
geom_histogram(bins = 30) +
facet_wrap(~ variable, scales = "free") +
theme_bw()
library(tidyverse)
library(ggpubr)
library(ggplot2)
library(dplyr)
library(purrr)
master <- read_csv("C:/Users/hanna/Florida International University/Coral Reef Fisheries - 2. Hannah-Marie Lamle/data/toUse/LSAT/master_LSAT_dataset.csv")
master$scale_cm <- factor(master$scale_cm, levels = c(25, 50, 100))
# fit model
all_sites_scale <- lm(
turf_length ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master
)
summary(all_sites_scale)
# prediction grid: vary rugosity, hold slope constant, include all 3 scales
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# correct model name here
newdata_rugo$pred <- predict(all_sites_scale, newdata = newdata_rugo)
# plot
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
# prediction grid: vary slope, hold rugosity constant, include all 3 scales
newdata_slope <- expand.grid(
slope_mean = seq(min(master$slope_mean, na.rm = TRUE),
max(master$slope_mean, na.rm = TRUE),
length.out = 100),
rugo_mean = mean(master$rugo_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# predicted values
newdata_slope$pred <- predict(all_sites_scale, newdata = newdata_slope)
# plot
ggplot(master, aes(x = slope_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_slope,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Slope on Turf Across Scales",
x = "Slope",
y = "Turf Length",
color = "Scale (cm)")
# fit model
all_sites_scale_sediment <- lm(
sediment_depth ~ rugo_mean * scale_cm + slope_mean * scale_cm,
data = master
)
summary(all_sites_scale_sediment)
# prediction grid: vary rugosity, hold slope constant, include all 3 scales
newdata_rugo <- expand.grid(
rugo_mean = seq(min(master$rugo_mean, na.rm = TRUE),
max(master$rugo_mean, na.rm = TRUE),
length.out = 100),
slope_mean = mean(master$slope_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# correct model name here
newdata_rugo$pred <- predict(all_sites_scale_sediment, newdata = newdata_rugo)
# plot
ggplot(master, aes(x = rugo_mean, y = sediment_depth)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Sediment Across Scales",
x = "Rugosity",
y = "Sediment Depth",
color = "Scale (cm)")
# prediction grid: vary slope, hold rugosity constant, include all 3 scales
newdata_slope <- expand.grid(
slope_mean = seq(min(master$slope_mean, na.rm = TRUE),
max(master$slope_mean, na.rm = TRUE),
length.out = 100),
rugo_mean = mean(master$rugo_mean, na.rm = TRUE),
scale_cm = factor(c(25, 50, 100), levels = c(25, 50, 100))
)
# predicted values
newdata_slope$pred <- predict(all_sites_scale_sediment, newdata = newdata_slope)
# plot
ggplot(master, aes(x = slope_mean, y = sediment_depth)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_slope,
aes(y = pred, color = scale_cm),
size = 1.2) +
theme_bw() +
labs(title = "Effect of Slope on Sediment Across Scales",
x = "Slope",
y = "Sediment Depth",
color = "Scale (cm)")
num_vars <- master %>% select(rugo_mean, slope_mean, sapr, std_curve, plan_curve, tpi)
num_vars %>%
gather(variable, value) %>%
ggplot(aes(value)) +
geom_histogram(bins = 30) +
facet_wrap(~ variable, scales = "free") +
theme_bw()
ggplot(master, aes(x = rugo_mean, y = turf_length)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo, aes(y = pred, color = scale_cm), size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Turf Across Scales",
x = "Rugosity",
y = "Turf Length",
color = "Scale (cm)")
ggplot(master, aes(x = rugo_mean, y = sediment_depth)) +
geom_point(alpha = 0.3, color = "gray50") +
geom_line(data = newdata_rugo_sd, aes(y = pred, color = scale_cm), size = 1.2) +
theme_bw() +
labs(title = "Effect of Rugosity on Sediment Depth Across Scales",
x = "Rugosity",
y = "Sediment Depth",
color = "Scale (cm)")
